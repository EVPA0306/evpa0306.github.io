<section class="page-header">
  <div class="container">
    <h1 class="page-title fade-in-up">PRICING</h1>
    <p class="page-subtitle fade-in-up">Choose the perfect training package for your goals</p>
  </div>
</section>

<section class="section pricing-section">
  <div class="container">
    <div class="pricing-intro text-center">
      <h2>Flexible Training Packages</h2>
      <p>All packages include personalized coaching, progress tracking, and access to our state-of-the-art facilities</p>
    </div>

    <div class="pricing-grid">
      <div class="pricing-card" 
           *ngFor="let product of products; let i = index" 
           [class.popular]="product.popular"
           [style.animation-delay.ms]="i * 100">
        
        <div class="popular-badge" *ngIf="product.popular">MOST POPULAR</div>
        
        <div class="pricing-header">
          <h3 class="package-name">{{ product.name }}</h3>
          <div class="price">
            <span class="currency">$</span>
            <span class="amount">{{ product.price }}</span>
          </div>
          <p class="price-description">{{ product.description }}</p>
        </div>

        <div class="pricing-features">
          <div class="feature" *ngIf="product.sessions">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
            <span>{{ product.sessions }} Training Sessions</span>
          </div>
          
          <div class="feature" *ngIf="product.duration">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
            <span>{{ product.duration }}</span>
          </div>
          
          <div class="feature">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
            <span>Professional Coaching</span>
          </div>
          
          <div class="feature">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
            <span>Progress Tracking</span>
          </div>
          
          <div class="feature">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
            <span>Facility Access</span>
          </div>

          <div class="feature" *ngIf="product.sessions && product.sessions >= 10">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
            <span>Nutrition Guidance</span>
          </div>

          <div class="savings" *ngIf="calculateSavings(product)">
            Save {{ formatPrice(calculateSavings(product)!) }}
          </div>
        </div>

        <button class="btn-purchase" 
                [class.btn-popular]="product.popular"
                (click)="selectProduct(product)">
          Purchase Now
        </button>
      </div>
    </div>

    <!-- Info Section -->
    <div class="payment-info">
      <div class="info-card">
        <h3>ðŸ’³ Secure Payments</h3>
        <p>All transactions are encrypted and secure. We accept major credit cards and PayPal.</p>
      </div>

      <div class="info-card">
        <h3>ðŸ“… Flexible Scheduling</h3>
        <p>Book your sessions at times that work for you. Easy online scheduling system.</p>
      </div>

      <div class="info-card">
        <h3>âœ… Satisfaction Guaranteed</h3>
        <p>Not satisfied? Get a full refund within 7 days of your first session.</p>
      </div>
    </div>
  </div>
</section>

<!-- Payment Modal -->
<div class="modal-overlay" *ngIf="showPaymentModal" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <button class="modal-close" (click)="closeModal()">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>

    <div class="modal-body" *ngIf="!paymentSuccess">
      <h2>Complete Your Purchase</h2>
      
      <div class="purchase-summary" *ngIf="selectedProduct">
        <h3>{{ selectedProduct.name }}</h3>
        <p class="summary-description">{{ selectedProduct.description }}</p>
        <div class="summary-price">
          Total: <strong>{{ formatPrice(selectedProduct.price) }}</strong>
        </div>
      </div>

      <div class="payment-methods" *ngIf="!paymentMethod">
        <h3>Select Payment Method</h3>
        
        <button class="payment-method-btn" (click)="selectPaymentMethod('stripe')">
          <div class="method-icon">
            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
              <line x1="1" y1="10" x2="23" y2="10"></line>
            </svg>
          </div>
          <div class="method-info">
            <strong>Credit / Debit Card</strong>
            <span>Powered by Stripe</span>
          </div>
        </button>

        <button class="payment-method-btn" (click)="selectPaymentMethod('paypal')">
          <div class="method-icon paypal">
            <svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor">
              <path d="M7.076 21.337H2.47a.641.641 0 0 1-.633-.74L4.944 3.72a.77.77 0 0 1 .759-.633h8.524c2.276 0 4.405.868 5.852 2.386a6.95 6.95 0 0 1 1.596 4.993c-.263 3.164-2.775 5.456-5.852 5.456H13.93L12.767 21.337z"/>
            </svg>
          </div>
          <div class="method-info">
            <strong>PayPal</strong>
            <span>Pay with PayPal</span>
          </div>
        </button>
      </div>

      <div class="payment-form" *ngIf="paymentMethod && !processing">
        <div class="selected-method">
          <button class="back-btn" (click)="paymentMethod = null">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
            Back
          </button>
          <span>{{ paymentMethod === 'stripe' ? 'Card Payment' : 'PayPal Payment' }}</span>
        </div>

        <div class="payment-notice">
          <p><strong>Demo Mode:</strong> This is a demonstration. No actual charges will be made.</p>
          <p>In production, this would redirect you to secure {{ paymentMethod === 'stripe' ? 'Stripe Checkout' : 'PayPal' }} to complete your payment.</p>
        </div>

        <button class="btn btn-primary btn-full" (click)="processPayment()">
          Proceed to {{ paymentMethod === 'stripe' ? 'Stripe' : 'PayPal' }} Checkout
        </button>
      </div>

      <div class="processing-state" *ngIf="processing">
        <div class="spinner"></div>
        <p>Processing your payment...</p>
      </div>

      <div class="error-message" *ngIf="paymentError">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
        <p>{{ errorMessage }}</p>
      </div>

      <div class="secure-notice">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
          <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
        </svg>
        <span>Secure encrypted payment</span>
      </div>
    </div>

    <div class="modal-body success-view" *ngIf="paymentSuccess">
      <div class="success-icon">
        <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="16 8 10 14 8 12"></polyline>
        </svg>
      </div>
      
      <h2>Payment Successful!</h2>
      <p>Your training package has been purchased successfully.</p>
      
      <div class="success-details">
        <p><strong>Package:</strong> {{ selectedProduct?.name }}</p>
        <p><strong>Amount:</strong> {{ formatPrice(selectedProduct?.price || 0) }}</p>
        <p class="confirmation-note">A confirmation email has been sent to your registered email address.</p>
      </div>

      <div class="success-actions">
        <button class="btn btn-primary" routerLink="/schedule" (click)="closeModal()">
          Schedule Your Sessions
        </button>
        <button class="btn btn-secondary" (click)="closeModal()">
          Close
        </button>
      </div>
    </div>
  </div>
</div>
